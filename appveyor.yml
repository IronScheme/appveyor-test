version: 1.0.{build}
skip_tags: true
image: Visual Studio 2022
branches:
  only:
  - main
configuration: Release
install:
- cmd: |
    cd %APPVEYOR_BUILD_FOLDER%
    git submodule update --init --recursive
    set SHA=%APPVEYOR_REPO_COMMIT:~0,7%
    choco install ilmerge
    set PATH=%PATH%;C:\Program Files (x86)\Microsoft SDKs\Windows\v10.0A\bin\NETFX 4.8 Tools\;%APPVEYOR_BUILD_FOLDER%\IronScheme\tools\;
    choco install dotnet-9.0-sdk --pre -y -r
    for /d %%d in (%LOCALAPPDATA%\Microsoft\VisualStudio\17.0*) do echo UsePreviews=True > %%d\sdk.txt
    for /d %%d in (%LOCALAPPDATA%\Microsoft\VisualStudio\17.0*) do type %%d\sdk.txt
build_script:
- cmd: |
    dotnet build /tl:off /v:n -m:1 --ucr /p:UseNetFxIlTools=true
    dotnet msbuild -restore /tl:off /v:n -m:1 /p:UseNetFxIlTools=true -p:RuntimeIdentifier=win-x64
    msbuild -restore /v:n -m:1 /p:UseNetFxIlTools=true -p:RuntimeIdentifier=win-x64
    dotnet build /tl:off /v:n -m:1 --ucr /p:UseNetFxIlTools=false 
    dotnet msbuild -restore /tl:off /v:n -m:1 /p:UseNetFxIlTools=false -p:RuntimeIdentifier=win-x64
    msbuild -restore /v:n -m:1 /p:UseNetFxIlTools=false -p:RuntimeIdentifier=win-x64
    dotnet build /tl:off /v:n -m:1 --ucr
    dotnet msbuild -restore /tl:off /v:n -m:1 -p:RuntimeIdentifier=win-x64
    msbuild -restore /v:n -m:1 -p:RuntimeIdentifier=win-x64
